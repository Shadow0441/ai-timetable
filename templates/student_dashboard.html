{% extends "layout.html" %}
{% block title %}Your Timetable - TimeWeave AI{% endblock %}

{% block head_styles %}
<style>
    .welcome-header {
        background: var(--card-bg);
        border: 1px solid var(--border);
        padding: 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
        text-align: center;
    }
    .welcome-header h1 {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.5rem;
    }
    .welcome-header p {
        color: var(--text-secondary);
        font-size: 1rem;
    }
    .content-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        padding: 2rem;
        border-radius: 1rem;
    }
    .table-dark-custom {
        background-color: transparent;
        border-radius: 0.5rem;
        overflow: hidden;
        width: 100%;
        border-spacing: 0;
        /* FIX: Use collapse for full-width borders */
        border-collapse: collapse;
    }
    .table-dark-custom th {
        background-color: rgba(255, 255, 255, 0.05);
        border-bottom: 2px solid var(--accent);
        color: var(--text-primary);
        padding: 1rem;
    }
    .table-dark-custom td {
        /* FIX: Increased border opacity for better visibility */
        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        vertical-align: middle;
        padding: 0.75rem;
        height: 110px;
    }
    .table-dark-custom tbody tr:last-child td {
        border-bottom: none;
    }
    .table-dark-custom th:first-child {
        width: 140px;
        text-align: center;
    }
    .table-dark-custom td:first-child {
        width: 140px;
        font-weight: 600;
        color: var(--text-primary);
        text-align: center;
        background-color: rgba(255, 255, 255, 0.03);
        border-right: 1px solid rgba(255, 255, 255, 0.15);
    }

    .timetable-slot {
        background: var(--accent-alt);
        border: 1px solid var(--accent);
        padding: 0.75rem;
        border-radius: 8px;
        text-align: left;
        margin-bottom: 0.5rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        transition: all 0.2s ease-in-out;
    }
    .timetable-slot:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 6px 20px rgba(157, 78, 221, 0.4);
        border-color: #fff;
    }
    .timetable-slot strong {
        color: #ffffff;
        font-size: 0.9rem;
        font-weight: 600;
        display: block;
        margin-bottom: 0.25rem;
    }
    .timetable-slot small {
        font-size: 0.8rem;
        color: #e0e0e0;
        opacity: 0.9;
    }
    .timetable-slot .fa-icon {
        color: #ffffff;
        opacity: 0.7;
        margin-right: 0.5rem;
    }

</style>
{% endblock %}

{% block content %}
<div class="welcome-header">
    <h1>{{ student.name }}'s Timetable ({{ student.admission_id }})</h1>
    <p>Course: <strong>{{ student.course }}</strong> | Branch: <strong>{{ student.branch }}</strong> | Year: <strong>{{ student.year }}</strong></p>
</div>

<div class="content-card">
    {% if timetable_data and timetable_data.schedule %}
    <div class="table-responsive">
        <table class="table table-dark-custom">
            <thead>
                <tr>
                    <th>Time</th>
                    {% for day in timetable_data.days %}
                        <th>{{ day }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for h in range(timetable_data.time_slots|length) %}
                <tr>
                    <td>{{ timetable_data.time_slots[h] }}</td>

                    {% for d in range(timetable_data.schedule|length) %}
                    <td>
                        {% for r in range(timetable_data.schedule[d][h]|length) %}
                            {% set subject_index = timetable_data.schedule[d][h][r] %}
                            {% if subject_index > 0 %}
                                <div class="timetable-slot">
                                    <strong>{{ timetable_data.subjects[subject_index|string] }}</strong>
                                    <small>
                                        {% set room_name = timetable_data.rooms[r] %}
                                        {% if 'lab' in room_name|lower %}
                                            <i class="fas fa-flask fa-icon"></i>
                                        {% else %}
                                             <i class="fas fa-chalkboard-teacher fa-icon"></i>
                                        {% endif %}
                                        {{ room_name }}
                                    </small>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <div class="text-center py-5">
            <i class="fas fa-calendar-times fa-4x text-secondary mb-3"></i>
            <h4 class="text-primary">No Timetable Available</h4>
            <p class="text-secondary">Your timetable has not been published by the institute yet. Please check back later.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

